<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <link rel="stylesheet" href="bootstrap.min.css">
  <link rel="stylesheet" href="bootstrap.css">  
  <link rel="stylesheet" href="font-awesome.min.css">

  <style>
      /* Always set the map height explicitly to define the size of the div
      * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #floating-panel {
        position: absolute;
        top: 10px;
        left: 25%;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
        text-align: center;
        font-family: 'Roboto','sans-serif';
        line-height: 30px;
        padding-left: 10px;
      }
/*      div.gm-style-iw{
        height:200%;
      }*/
      #legend {
        font-family: Arial, sans-serif;
        background: #fff;
        padding: 10px;
        margin: 10px;
        border: 3px solid #000;
      }
      #legend h3 {
        margin-top: 0;
      }
      #legend img {
        vertical-align: middle;
      }
      </style>
    </head>
    <body>
    
    <div id="floating-panel" class="hidden">
      <input type="button" value="ancient button = 1" class="ocultaMarcadorvermelho hidden"></input>
      <input type="button" value="ancient button= 0" class="mostraMarcadorvermelho hidden"></input>
      <input type="button" value="ancient button = 1" class="ocultaMarcadorazul hidden"></input>
      <input type="button" value="ancient button= 0" class="mostraMarcadorazul hidden"></input>
      <input type="button" value="ancient button = 1" class="ocultaMarcadorverde hidden"></input>
      <input type="button" value="ancient button= 0" class="mostraMarcadorverde hidden"></input>
      <input type="button" value="ancient button = 1" class="ocultaMarcadoramarelo hidden"></input>
      <input type="button" value="ancient button= 0" class="mostraMarcadoramarelo hidden"></input>
      <input type="button" value="ancient button = 1" class="ocultaMarcadorroxo hidden"></input>
      <input type="button" value="ancient button= 0" class="mostraMarcadorroxo hidden"></input>

    </div>   
      <div id="map"></div>
      <div id="legend"><h3>Legenda</h3></div>
<!-- 
      <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCaJxFyke87l3sHBTsjsFu3yCKhmYbs-zQ&callback=initMap"async defer></script> 
    -->
    <script src="jquery.min.js"></script>

    <script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js"></script>
    <script src="data.json"></script>
    <script>
// alert("Não importa a cor do gato, o que importa é que ele caçe os ratos. Deng Xiao-ping");

var Queima = 0;
var Enchente = 0;
var Animal = 0;
var Queda = 0;
var Vazamento = 0;

var map, heatmap;
var historicalOverlay;
//COMECO FUNCAO   40.740, -74.18    -22.9068467,-43.1728965
function initMap() {
  map = new google.maps.Map(document.getElementById('map'), {
    zoom: 9,
    center: new google.maps.LatLng(-22.9068467,-43.1728965),  
      mapTypeId: 'hybrid'//hybrid, roadmap - os melhores
    });

//CONFIGURACAO MARK PERSONALIZADO
// var alias[];
var features = [];
var alias = [];
for(var i = 0; i < obj.vetor.length; i++){
  if(obj.vetor[i].ocorrencia=='Queima'){var tipoMarcador = 'amarelo'; Queima+=1;}
    if(obj.vetor[i].ocorrencia=='Enchente'){var tipoMarcador = 'azul'; Enchente+=1;}
      if(obj.vetor[i].ocorrencia=='Animal Morto'){var tipoMarcador = 'vermelho'; Animal+=1;}
        if(obj.vetor[i].ocorrencia=='Queda de arvore'){var tipoMarcador = 'verde'; Queda+=1;}
          if(obj.vetor[i].ocorrencia=='Vazamento'){var tipoMarcador = 'roxo'; Vazamento+=1;}

            features.push({position: new google.maps.LatLng(obj.vetor[i].latitude, obj.vetor[i].longitude),type: tipoMarcador},);       
          alias[i] = obj.vetor[i].ocorrencia;
        alias[i] = alias[i].replace(/[\s-]/g, '');//Sem espaço
        alias[i] = alias[i].toLowerCase();//Sem maiusculos
        alias[i] = alias[i].replace(/[ÀÁÂÃÄÅ]/g,"A");
        alias[i] = alias[i].replace(/[àáâãäå]/g,"a");
        alias[i] = alias[i].replace(/[ÈÉÊË]/g,"E");
        alias[i] = alias[i].replace(/[èéêë]/g,"e");     
        alias[i] = alias[i].replace(/[^a-z0-9--]/gi, '');//Apenas letras e numros
        // console.log(alias[i]);

      }

//CONFIGURACAO PERSONALIZACAO DO MARK
var iconBase = 'http://maps.google.com/mapfiles/ms/icons/';
var icons = {
  vermelho: {
    name: 'AnimalMorto',
    icon: iconBase + 'red-dot.png',
    nameinlegend: 'Animal Morto',
    numero: Animal
  },
  azul: {
    name: 'Enchente',
    icon: iconBase + 'blue-dot.png',
    nameinlegend: 'Enchente',
    numero: Enchente
  },
  verde: {
    name: 'QuedadeArvore',
    icon: iconBase + 'green-dot.png',
    nameinlegend: 'Queda de Arvore',
    numero: Queda
  },
  amarelo: {
    name: 'Queima',
    icon: iconBase + 'yellow-dot.png',
    nameinlegend: 'Queima',
    numero: Queima
  },
  roxo: {
    name: 'Vazamento',
    icon: iconBase + 'purple-dot.png',
    nameinlegend: 'Vazamento',
    numero: Vazamento
  }          
};

// Create markers.
var markers = [];
features.forEach(function(feature) {
  var marker = new google.maps.Marker({
    position: feature.position,
    icon: icons[feature.type].icon,
    map: map
  });
  markers.push(marker);
});

var markerCluster = new MarkerClusterer(map, markers, {imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'});

var prioridade1 = "<span style='color: red'><i class='fa fa-circle' aria-hidden='true'></i>&nbsp;&nbsp;<i class='fa fa-circle' aria-hidden='true'></i>&nbsp;&nbsp;<i class='fa fa-circle' aria-hidden='true'></i>&nbsp;&nbsp;<i class='fa fa-circle' aria-hidden='true'></i></span>";
var prioridade2 = "<span style='color: rgba(255,64,0,1);'><i class='fa fa-circle' aria-hidden='true'></i>&nbsp;&nbsp;<i class='fa fa-circle' aria-hidden='true'></i>&nbsp;&nbsp;<i class='fa fa-circle' aria-hidden='true'></i></span>&nbsp;&nbsp;<span style='color: rgba(255,64,0,0.5);'><i class='fa fa-circle' aria-hidden='true'></i></span>";
var prioridade3 = "<span style='color: rgba(255,255,0,1);'><i class='fa fa-circle' aria-hidden='true'></i>&nbsp;&nbsp;<i class='fa fa-circle' aria-hidden='true'></i></span>&nbsp;&nbsp;<span style='color: rgba(255,255,0,0.5);'><i class='fa fa-circle' aria-hidden='true'></i>&nbsp;&nbsp;<i class='fa fa-circle' aria-hidden='true'></i></span>";
var prioridade4 = "<span style='color: rgba(4,180,4,1);'><i class='fa fa-circle' aria-hidden='true'></i></span>&nbsp;&nbsp;<span style='color: rgba(4,180,4,0.5);'><i class='fa fa-circle' aria-hidden='true'></i>&nbsp;&nbsp;<i class='fa fa-circle' aria-hidden='true'></i>&nbsp;&nbsp;<i class='fa fa-circle' aria-hidden='true'></i></span>";

var status1 = "<span style='border-radius:25px;background-color:#00BFFF;color:white;border-color:#00BFFF;font-weight:500;'>&nbsp;&nbsp;Em Andamento&nbsp;&nbsp;</span>";
var status2 = "<span style='border-radius:25px;background-color:#04B431;color:white;border-color:#04B431;font-weight:500;'>&nbsp;&nbsp;&nbsp;Finalizando&nbsp;&nbsp;&nbsp;</span>";
var status3 = "<span style='border-radius:25px;background-color:#FFBF00;color:white;border-color:#FFBF00;font-weight:500;'>&nbsp;&nbsp;&nbsp;Aguardando&nbsp;&nbsp;&nbsp;</span>";

var infowindow = [];
var contentString = [];
for(var i = 0; i < markers.length; i++){

  if(obj.vetor[i].nivel==1){var prioridadeResultado=prioridade1;}
  if(obj.vetor[i].nivel==2){var prioridadeResultado=prioridade2;}
  if(obj.vetor[i].nivel==3){var prioridadeResultado=prioridade3;}
  if(obj.vetor[i].nivel==4){var prioridadeResultado=prioridade4;}

  if(obj.vetor[i].status=='Em Andamento'){var statusResultado=status1;}
  if(obj.vetor[i].status=='Finalizando'){var statusResultado=status2;}
  if(obj.vetor[i].status=='Aguardando'){var statusResultado=status3;}

  contentString[i] =
// "<span style='left:5%;border-radius:25px;background-color:red;color:white;'><i class='fa fa-exclamation-triangle' aria-hidden='true'></i></span>"+
"<span style='display:block;margin-bottom:5%;' class='espaco' style='font-size:110%;'><b>Prioridade:</b> "+prioridadeResultado+
"</span><span style='display:block;margin-bottom:5%;' class='espaco'><b>Tipo:</b> "+obj.vetor[i].ocorrencia+
"</span><span style='display:block;margin-bottom:5%;' class='espaco'><b>Situação:</b> "+obj.vetor[i].relevancia+
"</span><span style='display:block;margin-bottom:5%;' class='espaco'><b>Status:</b> "+statusResultado+
"</span><span style='display:block;margin-bottom:5%;' class='data'><b>Data:</b> "+obj.vetor[i].data+
"</span>";
infowindow[i] = new google.maps.InfoWindow({
  content: contentString[i]
});
laco(i);
}

$( ".ocultaMarcadorvermelho" ).click(function() {
for (var i=0;i<markers.length;i++) {
  if (obj.vetor[i].ocorrencia=='Animal Morto')  {
    markers[i].setVisible(false);
    // alert(obj.vetor[i-1].id);
  }
}
});
$( ".mostraMarcadorvermelho" ).click(function() {
for (var i=0;i<markers.length;i++) {
  if (obj.vetor[i].ocorrencia=='Animal Morto')  {
    markers[i].setVisible(true);
    // alert(obj.markers[i-1]);
  }
}
});
$( ".ocultaMarcadorazul" ).click(function() {
for (var i=0;i<markers.length;i++) {
  if (obj.vetor[i].ocorrencia=='Enchente')  {
    markers[i].setVisible(false);
    // alert(obj.vetor[i-1].id);
  }
}
});
$( ".mostraMarcadorazul" ).click(function() {
for (var i=0;i<markers.length;i++) {
  if (obj.vetor[i].ocorrencia=='Enchente')  {
    markers[i].setVisible(true);
    // alert(obj.markers[i-1]);
  }
}
});
$( ".ocultaMarcadorverde" ).click(function() {
for (var i=0;i<markers.length;i++) {
  if (obj.vetor[i].ocorrencia=='Queda de arvore')  {
    markers[i].setVisible(false);
    // alert(obj.vetor[i-1].id);
  }
}
});
$( ".mostraMarcadorverde" ).click(function() {
for (var i=0;i<markers.length;i++) {
  if (obj.vetor[i].ocorrencia=='Queda de arvore')  {
    markers[i].setVisible(true);
    // alert(obj.markers[i-1]);
  }
}
});
$( ".ocultaMarcadoramarelo" ).click(function() {
for (var i=0;i<markers.length;i++) {
  if (obj.vetor[i].ocorrencia=='Queima')  {
    markers[i].setVisible(false);
    // alert(obj.vetor[i-1].id);
  }
}
});
$( ".mostraMarcadoramarelo" ).click(function() {
for (var i=0;i<markers.length;i++) {
  if (obj.vetor[i].ocorrencia=='Queima')  {
    markers[i].setVisible(true);
    // alert(obj.markers[i-1]);
  }
}
});
$( ".ocultaMarcadorroxo" ).click(function() {
for (var i=0;i<markers.length;i++) {
  if (obj.vetor[i].ocorrencia=='Vazamento')  {
    markers[i].setVisible(false);
    // alert(obj.vetor[i-1].id);
  }
}
});
$( ".mostraMarcadorroxo" ).click(function() {
for (var i=0;i<markers.length;i++) {
  if (obj.vetor[i].ocorrencia=='Vazamento')  {
    markers[i].setVisible(true);
    // alert(obj.markers[i-1]);
  }
}
});


function laco(n){
  markers[n].addListener('click', function() {
    infowindow[n].open(map, markers[n]);
    // alert(n);
  });  
}


var legend = document.getElementById('legend');
for (var key in icons) {
  var type = icons[key];
  var name = type.name;
  var nameinlegend = type.nameinlegend;
  var numero = type.numero;  
  var icon = type.icon;
  var div = document.createElement('div');
  div.innerHTML = '<img id="'+name+'" src="' + icon + '"> ' + nameinlegend + ' - ' + numero + '<br><br>';
  legend.appendChild(div);
}

map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(legend);
// markers.push(marker);


}
//FIM FUNCAO
//CONFIGURACAO HEATMAP CONFIGURANDO

//CONFIGURACAO HEATMAP - LatLng
/* Data points defined as an array of LatLng objects */
function heatmapData(){
  return [
  // {location: new google.maps.LatLng(-22.9068467, -43.1728965), weight: 3},
  new google.maps.LatLng(-22.9068467, -43.1728965), 
  new google.maps.LatLng(-22.7638274, -43.45442116),
  new google.maps.LatLng(-22.88280973, -43.42146217),
  new google.maps.LatLng(-22.6954289, -43.23744118),
  new google.maps.LatLng(-22.68402583, -43.46540749),
  new google.maps.LatLng(-22.65614765, -43.02183449),
  new google.maps.LatLng(-22.91665804, -43.19824219),
  new google.maps.LatLng(-22.90274343, -43.08151245),
  new google.maps.LatLng(-22.84960176, -43.08151245),
  new google.maps.LatLng(-22.7951733, -43.19274902),

  new google.maps.LatLng(-22.99663134, -43.17152321),
  new google.maps.LatLng(-22.9175987, -42.81446754),
  new google.maps.LatLng(-23.00674418, -43.28550636),
  new google.maps.LatLng(-22.99726341, -43.36790382),
  new google.maps.LatLng(-22.96565605, -43.39399635),
  new google.maps.LatLng(-22.89040081, -43.11659157),
  new google.maps.LatLng(-22.82966026, -43.13238442),
  new google.maps.LatLng(-22.70303042, -43.05891335),
  new google.maps.LatLng(-22.66882025, -43.24911415),
  new google.maps.LatLng(-22.75053038, -43.27040016)
  ];
}

$(document).ready(function() {
  var x = false;
  $("#AnimalMorto").on('click', function() {
    if (!x) {
      $(".ocultaMarcadorvermelho").trigger('click');
      x = true;
    } else {
      $(".mostraMarcadorvermelho").trigger('click');
      x = false;
    }
  });
  $("#Enchente").on('click', function() {
    if (!x) {
      $(".ocultaMarcadorazul").trigger('click');
      x = true;
    } else {
      $(".mostraMarcadorazul").trigger('click');
      x = false;
    }
  });
  $("#QuedadeArvore").on('click', function() {
    if (!x) {
      $(".ocultaMarcadorverde").trigger('click');
      x = true;
    } else {
      $(".mostraMarcadorverde").trigger('click');
      x = false;
    }    
  });
  $("#Queima").on('click', function() {
    if (!x) {
      $(".ocultaMarcadoramarelo").trigger('click');
      x = true;
    } else {
      $(".mostraMarcadoramarelo").trigger('click');
      x = false;
    }
  });
  $("#Vazamento").on('click', function() {
    if (!x) {
      $(".ocultaMarcadorroxo").trigger('click');
      x = true;
    } else {
      $(".mostraMarcadorroxo").trigger('click');
      x = false;
    }
  });

});
  </script>
  <script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js">
  </script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCaJxFyke87l3sHBTsjsFu3yCKhmYbs-zQ&libraries=visualization&callback=initMap"></script> 

</body>
</html>
